<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scripting (Complex procedures)</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
	<h3>Scripting (Complex procedures)</h3>
    <br>
    
        <h4>Fix the well for Feargus - Arroyo</h4>
            <img src="images\FO2_Arroyo_Feargus.jpg" alt="FO2 Arroyo Feargus">
            <p>At the center of the Arroyo village there is a well, and Feargus, the Chosen One's nephew, is standing next to it, 
                whining because it is broken. Simply Repair the well. Even with a negative Repair skill, it can still be fixed.</p>
            <p>This procedure is executed when the player uses the repair skill on the well. After using the skill, a message appears, and the player is rewarded with experience points.</p>
                <code>
                    <pre>
                        <span class="dyestatement">procedure</span> <span class="dyeprocedure">use_skill_on_p_proc</span> <span class="dyestatement">begin</span>
                            <span class="dyestatement">if</span> ((<span class="dyefunction">action_being_used</span> <span class="dyeoperator">==</span> <span class="dyehardcoded">SKILL_REPAIR</span>) <span class="dyestatement">and</span> (<span class="dyefunction">local_var</span>(LVAR_Gave_Xp) <span class="dyeoperator">==</span> <span class="dyedefine">0</span>)) <span class="dyestatement">then begin</span>
                                <span class="dyefunction">script_overrides</span>;
                                <span class="dyefunction">display_msg</span>(<span class="dyefunction">message_str</span>(SCRIPT_GENERIC,<span class="dyedefine">1005</span>));
                                <span class="dyedevelopermacro"">give_xp</span>(EXP_FIX_WELL);
                                <span class="dyefunction">set_map_var</span>(MVAR_Fixed_Well,</span><span class="dyedefine">1</span>);
                                <span class="dyefunction">set_local_var</span>(LVAR_Gave_Xp,</span><span class="dyedefine">1</span>);
                            <span class="dyestatement">end</span>
                        <span class="dyestatement">end</span>
                    </pre>
                </code>
        <br>

        <h4>How does this work in detail? Let’s break it down.</h4> 
            <p>The procedures use_skill_on_p_proc is called.</p>
                <code>
                    <pre>
                        <span class="dyestatement">procedure</span> <span class="dyeprocedure">use_skill_on_p_proc</span> <span class="dyestatement">begin</span>
                        <span class="dyestatement">end</span>
                    </pre>
                </code>
            <p>The first function action_being_used checks if the repair skill, written as SKILL_REPAIR, is used on the well. 
                The second one local_var checks if the local variable  LVAR_Gave_Xp is equal 0. 
                If both conditions match the following code is executed, else the procedure ends without anything been done.</p>
                <code>
                    <pre>
                        <span class="dyestatement">if</span> ((<span class="dyefunction">action_being_used</span> <span class="dyeoperator">==</span> <span class="dyehardcoded">SKILL_REPAIR</span>) <span class="dyestatement">and</span> (<span class="dyefunction">local_var</span>(LVAR_Gave_Xp) <span class="dyeoperator">==</span> <span class="dyedefine">0</span>)) <span class="dyestatement">then begin</span>
                    </pre>
                </code>
            <p>For certain procedures in the game there are default functions that are called when nothing is written inside these procedures. 
                To prevent these default functions to happen when something is indeed written inside the procedures the function script_overrides is used.</p>
                <code>
                    <pre>
                        <span class="dyefunction">script_overrides</span>;
                    </pre>
                </code>
            <p>Show message line 1005 of file GENERIC.msg.</p>
            <p>The function display_msg invokes the functionality to display a message. The function message_str has two arguments in this case. 
                SCRIPT_GENERIC is the message file (.msg) that contains all lines of text that should be used for generic purposes. 
                This file is actually named GENERIC.msg and is located at \text\english\dialog\GENERIC.msg. 100 and 101 are the lines which are contained inside the file GENERIC.msg.</p>
                <code>
                    <pre>
                        <span class="dyefunction">display_msg</span>(<span class="dyefunction">message_str</span>(SCRIPT_GENERIC,<span class="dyedefine">1005</span>));
                    </pre>
                </code>
            <p>Inside EXPPOINT.H you’ll find the definition of the macro give_xp(x).</p>
                <code>
                    <pre>
                        <span class="dyedefine">#define</span> <span class="dyedevelopermacro"">give_xp</span>(x)    <span class="dyefunction">give_exp_points</span>(x);
                                              <span class="indent278px" class="dyefunction">display_msg</span>(<span class="dyefunction">message_str</span>(SCRIPT_GENERIC,<span class="dyedefine">100</span>)+x+<span class="dyefunction">message_str</span>(SCRIPT_GENERIC,<span class="dyedefine">101</span>))
                    </pre>
                </code>
            <p>You can also define the amount of given exp points in the file EXPPOINT.H. In this example it’s EXP_FIX_WELL. 100 means 100 exp points given.</p>
                <code>
                    <pre>
                        <span class="dyedefine">#define</span> EXP_FIX_WELL &emsp; &emsp; &emsp; (<span class="dyedefine">100</span>)
                    </pre>
                </code>
            <p>As you can see in the file ASWELL.SSL the macro give_xp is used with the defined argument EXP_FIX_WELL. 
                So, if you want to change the amount of exp points given. You just must change the defined argument in the file EXPPOINT.H.</p>
                <code>
                    <pre>
                        <span class="dyedevelopermacro"">give_xp</span>(EXP_FIX_WELL);
                    </pre>
                </code>
            <p>The function set_map_var sets the map variable MVAR_Fixed_Well to 1. The game remembers that the well has been fixed even if you change the map. 
                So, it’s not possible to trick the game and invoking this quest again.</p>
                <code>
                    <pre>
                        <span class="dyefunction">set_map_var</span>(MVAR_Fixed_Well,</span><span class="dyedefine">1</span>);
                    </pre>
                </code>
            <p>The map variable MVAR_Fixed_Well is located in the ARVILLAG.H file inside the header folder.</p>
                <code>
                    <pre>
                        <span class="dyedefine">#define</span> MVAR_Fixed_Well</span> &emsp; &emsp; (<span class="dyedefine">4</span>)
                    </pre>
                </code>
            <p>The set_local_var function sets the local variable LVAR_Gave_Xp to 1.
                So, if the player tries to invoke the procedure use_skill_on_p_proc again on the well, nothing happens.</p>
                <code>
                    <pre>
                        <span class="dyefunction">set_local_var</span>(LVAR_Gave_Xp,</span><span class="dyedefine">1</span>);
                    </pre>
                </code>
        <br>
        <br>

    <div class="sticky">
        <a href="basic.html">&laquo; Previous</a>
        <br>
            <img class="sticky" src="images\Radioactive_symbol.png">	
        <br>
        <a href="index.html">Index</a>
        <br>
            <img class="sticky" src="images\Radioactive_symbol.png">	
        <br>
        <a href="addendum.html">Next &raquo;</a>
    </div>

    <!--<footer>
        <div class="symbol">
            <a href="basic.html">&laquo; Previous</a>
                <img src="images\Radioactive_symbol.png">
            <a href="index.html">Index</a>
                <img src="images\Radioactive_symbol.png">	
            <a href="addendum.html">Next &raquo;</a>
        </div>
    </footer>-->
</body>
</html>
