<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scripting (Advanced) - Dialog</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <h3>Dialog</h3>
    <br>

        <h4>Let's talk about...</h4>
            <p>Do you remember this guy?</p>
            <img src="images\Talk_to_Klint_remember.png" alt="">
            <p>It's Klint. Say hi to Klint.</p>
            <img src="images\Talk_to_Klint.png" alt="">
            <p>The mouth symbol is the procedure talk_p_proc.</p>
            <img src="images\Talk_to_Klint_dialogsystem.png" alt="">
            <p>The conversation has been initiated and the dialog system appears. Now you see two lines of text. But how does the engine know when which text to say?
                Well to understand how it works, we need to dig down deeper and take a look at two files ACKLINT.SSL and ACKLINT.MSG.</p>
            <p>First file is ACKLINT.SSL located here:</p>
                <code>
                    <pre>
                        X:\...\...\BIS mapper patched (+complementary ressources)\BIS mapper\scripts\ARROYO
                    </pre>
                </code>
                <code>
                    <pre>
                        <span class="dyestatement">procedure</span> <span class="dyeprocedure">talk_p_proc</span> <span class="dyestatement">begin</span>
                            [...]
                            <span class="dyestatement">if</span> ((<span class="dyefunction">obj_art_fid</span>(<span class="dyefunction">dude_obj</span>) <span class="dyeoperator">==</span> FID_HMWARR) <span class="dyestatement">or</span> (<span class="dyefunction">obj_art_fid</span>(<span class="dyefunction">dude_obj</span>) <span class="dyeoperator">==</span> FID_HFPRIM)) <span class="dyestatement">then</span> <span class="dyestatement">begin</span>
                                <span class="dyefunction">start_gdialog</span>(NAME,<span class="dyefunction">self_obj</span>,<span class="dyedefine">4</span>,<span class="dyedefine">-1</span>,<span class="dyedefine">-1</span>);
                                <span class="dyefunction">gSay_Start</span>;
                                    <span class="dyestatement">call</span> <span class="dyeprocedure">Node001</span>;
                                <span class="dyefunction">gSay_End</span>;
                                <span class="dyefunction">end_dialogue</span>;
                            <span class="dyestatement">end</span>

                            <span class="dyestatement">else</span> <span class="dyestatement">begin</span>
                                <span class="dyefunction">start_gdialog</span>(NAME,<span class="dyefunction">self_obj</span>,<span class="dyedefine">4</span>,<span class="dyedefine">-1</span>,<span class="dyedefine">-1</span>);
                                <span class="dyefunction">gSay_Start</span>;
                                    <span class="dyestatement">call</span> <span class="dyeprocedure">Node006</span>;
                                <span class="dyefunction">gSay_End</span>;
                                <span class="dyefunction">end_dialogue</span>;
                            <span class="dyestatement">end</span>
                        <span class="dyestatement">end</span>
                    </pre>
                </code>
            <p>This is procedure talk_p_proc or at least a part of it. Dialog begins here but we are only interested in call Node006; the rest is unimportant for now.
                Let's jump to call Node006;. </p>
                <code>
                    <pre>
                        <span class="dyestatement">procedure</span> <span class="dyeprocedure">Node006</span> <span class="dyestatement">begin</span>
                            <span class="dyestandardmacro">Reply</span>(<span class="dyedefine">121</span>);

                            [...]
                            <span class="dyestandardmacro">NOption</span>(<span class="dyedefine">123</span>,<span class="dyeprocedure">Node007</span>,<span class="dyedefine">004</span>);
                        <span class="dyestatement">end</span>
                    </pre>
                </code>
            <p>You can probably guess that 121 and 123 are the two lines we've seen at the screenshots when you started talking to Klint and the dialog window appeared. 
                But where do they come from? Let's take a look at ACKLINT.MSG located here:</p>
                <code>
                    <pre>
                        X:\Fallout 2\data\text\english\dialog
                    </pre>
                </code>
            <p>Try and open the file with notepad, notepad++, Sfall script editor or whatever you prefer. After you opened the file, it will look like this:</p>
                <code>
                    <pre>
                        {100}{}{You see Klint, a fellow tribesman.}
                        {101}{}{You see Klint.}
                        {102}{}{You see a young man with bulging muscles and a very confident air about him.}
                        {103}{}{Good day to you, }
                        {104}{}{. You have not completed the trial of the Elder and may not pass.}
                        {105}{}{Uh...}
                        {106}{}{I need to go back to the village.}
                        {107}{}{I have some questions of you.}
                        {108}{}{All right, I'm off to take the test.}
                        {109}{}{(sigh) }
                        {110}{}{. You go temple. You take test. You not come back here until take test. Obey Elder. Go!}
                        {111}{}{Me go.}
                        {112}{}{Forgive me, }
                        {113}{}{, but I can not allow you to pass. If you wish to return to the village you may do so only by passing the trial set before you.}
                        {114}{}{I see. I guess I'll be going then.}
                        {115}{}{Can I ask you some questions then?}
                        {116}{}{I could kick your ass and just walk out of here.}
                        {117}{}{Forgive me, but I have no answers to your questions. Take the trial set before you by the Elder and prove yourself worthy to lead our people.}
                        {118}{}{Very well.}
                        {119}{}{Two people working together can move the obelisk that blocks the path. Alone, you would fail. I have no intention of helping you until you pass the trial of the Elder.}
                        {120}{}{Uh-huh. I get the picture.}
                        {121}{}{Greetings, Chosen One! It is good to see you. How may I serve you?}
                        {122}{}{Me say hi. That all.}
                        {123}{}{Just thought I'd say hello. I'll be leaving on my quest soon.}
                        {124}{}{May the spirits of our ancestors protect you, Chosen One. I wish you well on your journey.}
                    </pre>
                </code>
            <p>Every piece of text related to Klint. As you can see lines 121 and 123 are located inside this message file. So, when dialog jumps to Node006 and lines 121 and 123 are requested, 
                the engine looks inside ACKLINT.MSG finds and returns the necessary text lines.</p>
            <p>You might have noticed that line 100, 101 and 102 contain descriptive text. They are used by the procedures look_at_p_proc and description_p_proc.</p>
            <p>left: look_at_p_proc; right: description_p_proc</p>
            <img src="images\look_at_p_proc.png" alt="">
            <img src="images\description_p_proc.png" alt="">
            <br>

            <h4>Message files basic framework</h4>
            <p>The basic framework of every message file is this:</p>
                <code>
                    <pre>
                        {}{}{}
                    </pre>
                </code>
            <p>Thats it. You just have to fill in these curvy brackets. The first pair of brackets contains the line number. The second pair stays always empty. 
                And the third one contains the sentences which will be said by the critters or the dude.
                The number inside the first pair of brackets simply is the line number of this dialog message. 
                So, if you want the npc or the dude talking to this npc say a certain sentence, you don't need to write the same sentence over and over again. 
                You just write the specific line number into your script which refers to the certain sentence you want the critters to say.</p>
            <p>Comments are written like this:</p>
                <code>
                    <pre>
                        # MyComment
                    </pre>
                </code>
            <p>Everything behind the hashtag is interpreted as a comment.</p>
            <p>I like my message files a bit more organized. Like this:</p>
                <code>
                    <pre>
                        #############################################################
                        #  
                        #
                        # Message File: HCPAVEL.msg                               
                        #                                                          
                        #       Body Type:  Pavel                                 
                        #       Combat AI: None                                     
                        #       Weapons: None                                       
                        #       HP: ?                                               
                        #       Skills to note: None                                
                        #                                                           
                        #  Log:                                                     
                        #                                                           
                        #  Created: August 10, 2021                               
                        #                                                           
                        #  Updated: August 14, 2021
                        #
                        #                                                
                        #############################################################


                        #############################################################
                        #  The following lines are used by look_at_p_proc and description_p_proc.
                        #############################################################
                        {100}{}{You see an old and grumpy looking man.}
                        {101}{}{This man looks like he consumes alot of alcohol and cigarettes.}
                        {102}{}{You see Pavel, the former scout.}
                        #############################################################


                        #############################################################
                        #  The following lines are only once used by NodeTalkIntro. Introductional conversation.
                        #############################################################
                        #Reply
                        {200}{}{Hm...? Who are you and what do you want? Me is Pavel.}
                        #NOption
                        {201}{}{Hi Pavel. Don't you recognize me? It's me }
                        {202}{}{. }
                        {203}{}{How do you do?} #Invokes NodeTalkAdvanced
                        {204}{}{ I'm just looking for work.} #Invokes NodeQuestStart 300
                        {205}{}{Bye.} #Invokes Node999
                        #############################################################


                        #############################################################
                        #  The following lines are only once used by NodeTalkAdvanced. Advanced conversation.
                        #############################################################
                        #Reply
                        {206}{}{What do you think how I'm doing? I ran out of hard stuff.}
                        #NOption
                        {207}{}{Can I do anything for you?} #Invokes NodeQuestStart 301
                        {208}{}{Ouh. That's sad. Bye!} #Invokes Node999
                        #############################################################


                        #############################################################
                        #  The following lines are used by NodeTalkReturn. If the player has already spoken to Pavel but didn't accept the Quest.
                        #############################################################
                        #Reply
                        {209}{}{You again. What'Cha want?}
                        #NOption
                        {210}{}{Still looking for work.} #Invokes NodeQuestStart 300
                        {211}{}{Bye again.} #Invokes Node999 or 
                        #############################################################


                        #############################################################
                        #  The following lines are used by NodeQuestStart. Initiating Quest: Get some alcohol.
                        #############################################################
                        #Reply
                        {300}{}{So you're looking for work! Okay! Listen here lazybones! Bring me some booze!} #Invoked by NodeTalkIntro 204
                        #NOption
                        {302}{}{Sounds easy. Wait here. I'll be back soon.} #Invokes the Quest to start.
                        {303}{}{Not interested. Have a nice day.} #Invokes Node999
                        #############################################################


                        #############################################################
                        #  The following lines are used by NodeQuestStart2. Initiating Quest: Get some alcohol.
                        #############################################################
                        #Reply
                        {301}{}{Yes you can! Bring me liquor, pronto!} #Invoked by NodeTalkAdvanced 207
                        #NOption
                        {305}{}{Sounds easy. Wait here. I'll be back soon.} #Invokes the Quest to start.
                        {306}{}{Not interested. Have a nice day.} #Invokes Node999
                        #############################################################


                        #############################################################
                        #  The following lines are used by NodeQuestReturn . If the player has already spoken to Pavel and did accept the Quest.
                        #############################################################
                        #Reply
                        {307}{}{Did you get my stuff?!} 
                        #NOption
                        {308}{}{Yep. Here it is.} #Invokes NodeQuestEnd
                        {309}{}{Nope, not yet.} #Invokes Node999
                        #############################################################


                        #############################################################
                        #  The following lines are used by NodeQuestEnd. If the player fulfilled the quest requirement.
                        #############################################################
                        #Reply
                        {310}{}{It's been about damn time!}
                        #NOption
                        {311}{}{I'm glad I could help you.} #Invokes reward.
                        #############################################################


                        #############################################################
                        #  The following lines are used by NodeTalkFinal. If the player has finished Pavels Quest and has already returned to him to get the reward.
                        #############################################################
                        #Reply
                        {312}{}{Hey man. Thanks again for the booze.}
                        #NOption
                        {313}{}{No problem mate. Cheers!}
                        #############################################################
                    </pre>
                </code>
            <p>You see the message file of my first character called Pavel. You can organize your message file as you like.</p>
        <br>
        
        <h5>Notice</h5>    
        <p>* Message files do always have the suffix .MSG. For example ACKLINT.MSG.</p>
        
        
    <div class="sticky">
        <a href="index.html">&laquo; Previous</a>
        <br>
            <img class="sticky" src="images\Radioactive_symbol.png">	
        <br>
        <a href="index.html">Index</a>
        <br>
            <img class="sticky" src="images\Radioactive_symbol.png">	
        <br>
        <a href="prep.html">Next &raquo;</a>
    </div>

</body>
</html>




  
                                
